!function(r,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):r.sortedJSONStringify=n()}(this,function(){"use strict";var r=function(r,n,t,e){var i=t+n,f=r.items.map(function(r){return u(r,n,i)}),o=n?"\n":"";return(e?"":t)+"["+o+f.join(","+o)+o+t+"]"},n=function(r,n,t){var e=n?": ":":";return t+r.key+e+u(r.value,n,t,!0)},t=function(r,t,e){if(0===r.length)return[];if(1===r.length)return[n(r[0],t,e)];var u=r.map(function(r,n){return[n,(t=r.key,-1===t.indexOf("\\")?t.slice(1,-1):JSON.parse(t))];var t});return u.sort(function(r,n){return r[1]===n[1]?0:r[1]<n[1]?-1:1}),u.map(function(u){var i=r[u[0]];return n(i,t,e)})},e=function(r,n,e,u){var i=e+n,f=n?"\n":"",o=t(r.items,n,i);return(u?"":e)+"{"+f+o.join(","+f)+f+e+"}"};function u(n,t){var u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if("scalar"===n.type)return(i?"":u)+n.value;if("array"===n.type)return r(n,t,u,i);if("object"===n.type)return e(n,t,u,i);throw new Error("unknown ast")}var i=function(r){for(var n=[];;){var t=c(r);if(!t)break;n.push(t)}return{type:"array",items:n}};var f=function(r){var n=r.shift();if("}"===n)return!1;var t=function(r){var n=r[r.length-1];if("{"===n||"["===n)return[r.slice(0,-3),n];var t=/^("(?:[^\\"]|\\.)*"): (.+)$/.exec(r);return[t[1],t[2]]}(n),e=t[0],u=t[1];return{key:e,value:"["===u?i(r):"{"===u?o(r):a(u)}},o=function(r){for(var n=[];;){var t=f(r);if(!t)break;n.push(t)}return{type:"object",items:n}},a=function(r){return{type:"scalar",value:r}};function c(r){var n=r.shift();return"["===n?i(r):"{"===n?o(r):"]"!==n&&a(n)}var v=function(r){return"number"==typeof r?function(r,n){if(n=Math.floor(n),r=String(r),!(n>0)||""===r)return"";for(var t="",e=0;e<n;++e)t+=r;return t}(" ",Math.min(r,10)):"string"==typeof r?r.substring(0,10):""},s=function(r,n){return JSON.stringify(r,n,1).split(/,?\n */)};return function(r,n,t){var e=v(t);return u(c(s(r,n)),e)}});